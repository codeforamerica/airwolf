<!DOCTYPE html>
<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	  <script src="js/bootstrap.min.js"></script>
	  <script src="js/mustache.js"></script>
	  <link href="css/stylesheets/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css" />
	  <link href="css/stylesheets/print.css" media="print" rel="stylesheet" type="text/css" />
		<link href="css/stylesheets/main.css" media="screen, projection" rel="stylesheet" type="text/css" />
	  <!--[if IE]>
	      <link href="/stylesheets/ie.css" media="screen, projection" rel="stylesheet" type="text/css" />
	  <![endif]-->
	    <script id="instruction" type="text/template">
	     <div id="spy" class="container-fluid" data-spy="scroll" data-target="#navbar" data-offset="200">
				  <div class="row-fluid">
				    <div class="span12 hero-unit">
				    	<div id="sampleArea"></div>
								{{#instruction}}
									<h1>{{name}}</h1>
									<p>{{description}}</p>
								{{/instruction}}
				    </div>
			    </div>
		    </div>
		    </script>
		    <script id="step" type="text/template">
			    <div id="step{{index}}" class="row-fluid stepRow">
			    	<div class="offset1 spacer"><div class="span8">
			    		<h2><span class="step">Step {{index}}:</span> {{0.name}}</h2>
			    			<p>{{0.description}}</p>
			    		</div>
			    	</div>
			    </div>
			</script>
			<script id="navigation" type="text/template">
				  <div class="navbar-inner subnav navbar-inverse">
				    <a class="brand" href="index2.html">CalFresh Helper</a>
				    <ul class="nav navbar-inverse">
				    <li><a href="#step{{index}}">Step {{index}} {{name}}</a></li>
				    </ul>
				  </div>
			</script>
  </head>
  <body>
		<div id="navbar" class="navbar navbar-inverse"></div><!-- end nav-bar-->
		<div class="container-fluid">
		  <div class="row-fluid">
		    <div class="span2">
		      <!--Sidebar content-->
		      <div class="well-special fixed">
						<div id="navbarExample" class="subnav">
		        	<ul class="nav nav-pills">
		        		<li class="active"><a href="#step1">Step 1 Prepare</a></li>
								<li><a href="#step2">Step 2 Apply</a></li>
						    <li><a href="#step3">Step 3 Email documents</a></li>
						    <li><a href="#step4">Step 4 Interview</a></li>
						    <li><a href="#next">What's next?</a></li>
						    <li><a href="#questions">Questions</a></li>
			        </ul>
			    	</div>
					</div>
		    </div>
		    <div id="spy" class="container-fluid" data-spy="scroll" data-target="#navbar" data-offset="200">
				  <div class="row-fluid">
				    <div class="span12 hero-unit">
				    	<div id="titleArea"></div>
				    	<!-- instruction name and description go here -->
				    </div>
			    </div>
		    </div>
		    <div id="stepArea"></div>
		
  </body>
  <script>
  $('#navbarExample>ul>li').removeClass('active');
  	$(function() {
  		var helperAPI = "http://sfairwolf.herokuapp.com/programs/1/instructions/1.json";
		  $.getJSON( helperAPI, {
		    format: "json"
		  })
		  .done(function( json ) {
		    // console.log(json);
		    var template = $('#instruction').html();
		    var html = Mustache.to_html(template, json);
		    $('#titleArea').html(html);
		    $.each(json.steps, function(index, step){
		    	var niceNumber = index +1;
		    	var templateSteps = $('#step').html();
		    	var templateNav = $('#navigation').html()
		    	step['index'] = []
		    	step['index'].push(niceNumber);
		    	console.log(step);
			    var htmlSteps = Mustache.to_html(templateSteps, step);
			    var navHtml = Mustache.to_html(templateNav, step);
			    $('#navbar').append(navHtml);
			    $('#stepArea').append(htmlSteps);
		    	// $('#spy').append('<div id="step'+niceNumber+'" class="row-fluid stepRow"><div class="offset1 spacer"><div class="span8"><h2><span class="step">Step'+niceNumber+':</span> '+step[0].name+'</h2><p>'+step[0].description+'</p></div></div></div>');
		    })
		  });

	  	$('#navbarExample').scrollspy()
			// fix the left nav box. from http://css-tricks.com/scrollfollow-sidebar/
	    var $sidebar   = $("#navbarExample"), 
	        $window    = $(window),
	        offset     = $sidebar.offset(),
	        topPadding = 5;

	    $window.scroll(function() {
	      if ($window.scrollTop() > offset.top) {
	          $sidebar.stop().animate({
	              marginTop: $window.scrollTop() - offset.top + topPadding
	          });
	      } else {
	          $sidebar.stop().animate({
	              marginTop: 0
	          });
	      }
	    });
	    //a dumb little function to update the active class when a user clicks a nav button
	    $('#navbarExample>ul>li>a').click(function(){
				$('#navbarExample>ul>li').removeClass('active');
	    	$(this).parent('li').addClass('active');
	    });
		});
  </script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40052704-1', 'github.io');
  ga('send', 'pageview');

</script>

<script>
/*
	Yes smart guy this is an MVP. Really just trying to prove it. Checkout this hack!! It took
	5 minutes to write. Need it because for some reason the last item in the nav list was automatically 
	getting selected on page load. Dunno why, but this kills it.
*/
	window.setTimeout(function(){
		$('#navbarExample>ul>li').removeClass('active');
		$('#navbarExample li').first().addClass('active');
	}, 200);
</script>
</html>
